<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í”¼ë“œ ì‘ì„± - MaxFeed</title>
  <link href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.min.css" rel="stylesheet">
</head>
<body>

<h2>ìƒˆ í”¼ë“œ ì‘ì„±</h2>
<textarea id="content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea><br>
<input type="file" id="file">
<button onclick="addFeed()">ì—…ë¡œë“œ</button>
<button onclick="location.href='index.html'">ì´ì „</button>

<script>
const api = 'https://supermax.kr/feed';

async function addFeed() {
  console.log("ğŸš€ addFeed() ì‹¤í–‰ë¨!"); // âœ… ì´ ë¡œê·¸ê°€ ëœ¨ëŠ”ì§€ í™•ì¸!

  const fileInput = document.getElementById('file');
  const content = document.getElementById('content').value;

  console.log("ğŸ“‚ íŒŒì¼ ì •ë³´:", fileInput.files[0]); // âœ… íŒŒì¼ì´ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸!
  console.log("ğŸ“ ë‚´ìš©:", content); // âœ… ë‚´ìš©ì´ ì •ìƒì ìœ¼ë¡œ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸!

  if (!fileInput.files.length) {
    alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!');
    return;
  }

  const formData = new FormData();
  formData.append('content', content);
  formData.append('file', fileInput.files[0]);

  const res = await fetch(`${api}/add-feed`, {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') },
    body: formData
  });

  if (res.ok) {
    alert('ì—…ë¡œë“œ ì™„ë£Œ');
    location.href = 'index.html';
  } else {
    const errorData = await res.json();
    console.error("ğŸ”¥ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜:", errorData);
    alert('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
  }
}

</script>

</body>
</html>
