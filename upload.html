<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>피드 작성 - MaxFeed</title>
  <link href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.min.css" rel="stylesheet">
</head>
<body>

<h2>새 피드 작성</h2>
<textarea id="content" placeholder="내용을 입력하세요"></textarea><br>
<input type="file" id="file">
<button onclick="addFeed()">업로드</button>
<button onclick="location.href='index.html'">이전</button>

<script>
const api = 'https://supermax.kr/feed';

async function addFeed() {
  console.log("🚀 addFeed() 실행됨!"); // ✅ 이 로그가 뜨는지 확인!

  const fileInput = document.getElementById('file');
  const content = document.getElementById('content').value;

  console.log("📂 파일 정보:", fileInput.files[0]); // ✅ 파일이 선택되었는지 확인!
  console.log("📝 내용:", content); // ✅ 내용이 정상적으로 들어갔는지 확인!

  if (!fileInput.files.length) {
    alert('파일을 선택하세요!');
    return;
  }

  const formData = new FormData();
  formData.append('content', content);
  formData.append('file', fileInput.files[0]);

  const res = await fetch(`${api}/add-feed`, {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') },
    body: formData
  });

  if (res.ok) {
    alert('업로드 완료');
    location.href = 'index.html';
  } else {
    const errorData = await res.json();
    console.error("🔥 서버 응답 오류:", errorData);
    alert('업로드 실패: ' + (errorData.error || '알 수 없는 오류'));
  }
}

</script>

</body>
</html>
